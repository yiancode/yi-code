# yi-code 余额充值功能 UX 设计文档

## 1. 设计概述

### 1.1 功能定位
余额充值功能允许用户通过微信支付为账户充值，实现便捷的在线支付体验。

### 1.2 设计目标
- **简洁高效**: 减少用户操作步骤，快速完成充值
- **状态清晰**: 订单状态一目了然，减少用户焦虑
- **视觉一致**: 与系统整体设计风格保持统一（Claude Orange 橙色系）

### 1.3 目标用户
- yi-code 平台注册用户
- 需要使用余额购买服务的用户

---

## 2. 页面结构

### 2.1 页面路由

| 路由 | 页面名称 | 说明 |
|-----|---------|------|
| `/recharge` | 充值主页 | 选择金额、发起支付、查看记录 |
| `/recharge/success` | 充值成功 | 支付成功确认页 |
| `/recharge/failed` | 充值失败 | 支付失败/过期提示页 |

### 2.2 页面布局结构

```
┌─────────────────────────────────────────────────────────────┐
│  顶部导航栏 (Header)                                         │
│  [余额充值] [在线充值余额，支付完成后自动到账]    [ZH] [$0.00] [用户]│
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │           余额展示卡片 (橙色渐变背景)                  │   │
│  │              [钱包图标]                              │   │
│  │              当前余额                                │   │
│  │              ¥0.00                                  │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  余额充值                                            │   │
│  │  在线充值余额，支付完成后自动到账                       │   │
│  │                                                     │   │
│  │  充值金额                                            │   │
│  │  [    输入框    ] [¥10] [¥20] [¥50] [¥100]          │   │
│  │                                                     │   │
│  │  [微信支付按钮]                                      │   │
│  │                                                     │   │
│  │  ┌─────────────────────────────────────────────┐   │   │
│  │  │ 支付订单已创建                                │   │   │
│  │  │ 请使用微信扫一扫完成支付    [查看支付二维码]    │   │   │
│  │  └─────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  充值记录                                   [刷新]   │   │
│  │  ┌─────────────────────────────────────────────┐   │   │
│  │  │ 订单号 │ 充值金额 │ 订单状态 │ 创建时间 │ 操作 │   │   │
│  │  ├─────────────────────────────────────────────┤   │   │
│  │  │ RECH... │ 20.00元 │ [待支付] │ 2026/... │[详情]│   │   │
│  │  │ RECH... │ 20.00元 │ [已过期] │ 2026/... │[详情]│   │   │
│  │  └─────────────────────────────────────────────┘   │   │
│  │  [分页组件]                                         │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. 组件规范

### 3.1 余额展示卡片

**视觉设计:**
- 背景: 橙色渐变 (`#d97757` → `#c45a3a`)，对应 Tailwind `bg-gradient-primary`
- 圆角: `16px` (rounded-2xl)
- 内边距: `40px`
- 居中对齐

**内容结构:**
```
[钱包图标] (白色背景圆形, 64x64px)
当前余额 (白色, 14px)
¥0.00 (白色, 48px, 粗体)
```

**代码参考:**
```vue
<div class="balance-card bg-gradient-to-r from-primary-500 to-primary-600 rounded-2xl p-10 text-center text-white">
  <div class="wallet-icon mx-auto mb-4 w-16 h-16 bg-white/20 rounded-full flex items-center justify-center">
    <Icon name="wallet" class="text-white text-2xl" />
  </div>
  <span class="block text-sm opacity-80">当前余额</span>
  <span class="block text-5xl font-bold mt-2">¥{{ balance }}</span>
</div>
```

---

### 3.2 金额选择器 (AmountSelector)

**组成元素:**
1. 输入框 - 自定义金额输入
2. 快捷金额按钮组 - 预设金额选项

**输入框规范:**
- 宽度: `200px`
- 高度: `44px`
- 边框: `1px solid #E0E0E0` (gray-200)
- 圆角: `12px` (rounded-xl)
- 字体: `16px`
- 聚焦态: `border-primary-500 ring-2 ring-primary-500/30`

**快捷按钮规范:**
| 状态 | 背景色 | 边框 | 文字颜色 |
|-----|-------|------|---------|
| 默认 | `#FFFFFF` | `1px solid #E0E0E0` | `#333333` |
| 选中 | `#fde8df` (primary-100) | `1px solid #d97757` (primary-500) | `#d97757` |
| 悬停 | `#fef7f4` (primary-50) | `1px solid #cbd5e1` | `#333333` |

**按钮尺寸:**
- 宽度: `64px`
- 高度: `44px`
- 圆角: `12px` (rounded-xl)
- 间距: `12px`

**交互逻辑:**
1. 点击快捷按钮 → 输入框显示对应金额，按钮高亮
2. 在输入框输入 → 取消所有快捷按钮选中状态
3. 输入框失焦时验证金额范围

**默认金额选项:** `[¥10, ¥20, ¥50, ¥100]`

---

### 3.3 支付方式按钮 (PaymentMethodButton)

**设计规范:**
- 背景色: `#d97757` → `#c45a3a` 渐变 (primary-500 → primary-600)
- 文字颜色: `#FFFFFF`
- 圆角: `24px` (胶囊型)
- 内边距: `12px 24px`
- 图标: 微信支付图标 (白色)
- 字体: `16px`
- 阴影: `shadow-md shadow-primary-500/25`

**状态:**
| 状态 | 背景色 | 效果 |
|-----|-------|------|
| 默认 | `from-primary-500 to-primary-600` | - |
| 悬停 | `from-primary-600 to-primary-700` | 轻微变深，阴影增强 |
| 按下 | `from-primary-700 to-primary-800` | 更深 |
| 禁用 | `#BDBDBD` (gray-400) | 不可点击 |
| 加载中 | `from-primary-500 to-primary-600` | 显示loading动画 |

**Tailwind 类名:**
```html
<button class="btn-primary rounded-3xl px-6 py-3">
  <Icon name="wechat-pay" />
  微信支付
</button>
```

---

### 3.4 支付状态提示卡片 (PaymentStatusCard)

**设计规范:**
- 背景色: `#fde8df` (primary-100)
- 边框: `1px solid #fbd0c0` (primary-200)
- 圆角: `12px`
- 内边距: `20px 24px`

**内容布局:**
```
┌──────────────────────────────────────────────────────┐
│ 支付订单已创建                                        │
│ 请使用微信扫一扫完成支付                [查看支付二维码] │
└──────────────────────────────────────────────────────┘
```

**文字规范:**
- 标题: `#c45a3a` (primary-600), `16px`, 粗体
- 描述: `#d97757` (primary-500), `14px`
- 按钮: 白色背景, `#d97757` 边框, 圆角 `20px`

**显示条件:** 存在待支付订单时显示

---

### 3.5 充值记录表格 (RechargeRecordTable)

**表格结构:**

| 列名 | 宽度 | 对齐 | 说明 |
|-----|------|-----|------|
| 订单号 | `200px` | 左对齐 | 链接样式，可点击 |
| 充值金额 | `120px` | 左对齐 | 格式: XX.XX 元 |
| 订单状态 | `100px` | 居中 | 标签样式 |
| 创建时间 | `150px` | 左对齐 | YYYY/MM/DD HH:mm:ss |
| 查看详情 | `150px` | 居中 | 操作按钮 |

**订单号样式:**
- 颜色: `#d97757` (primary-500，链接色)
- 可点击跳转到订单详情

**状态标签设计:**

| 状态 | 文字 | 背景色 | 文字颜色 | Tailwind类 |
|-----|-----|-------|---------|------------|
| pending | 待支付 | `#FFF8E1` | `#F57C00` | `badge-warning` |
| paid | 已支付 | `#E8F5E9` | `#4CAF50` | `badge-success` |
| expired | 已过期 | `#F5F5F5` | `#9E9E9E` | `badge-gray` |
| failed | 失败 | `#FFEBEE` | `#F44336` | `badge-danger` |
| refunded | 已退款 | `#E3F2FD` | `#2196F3` | `badge-primary` (蓝色) |

**操作按钮:**
- 查看详情: 始终显示
- 重新支付: 仅 `pending` 状态显示

**分页组件:**
- 显示: "显示 X 至 Y 共 Z 条结果"
- 每页条数选择器: `[10, 20, 50]`
- 页码导航: `< [1] [2] [3] ... >`

---

### 3.6 支付二维码弹窗 (PaymentQRCodeModal)

**弹窗规范:**
- 宽度: `480px`
- 背景: `#FFFFFF`
- 圆角: `16px` (rounded-2xl)
- 阴影: `shadow-2xl`
- 遮罩: `bg-black/50 backdrop-blur-sm`

**内容布局:**
```
┌────────────────────────────────────────┐
│ 订单信息                            [×] │
├────────────────────────────────────────┤
│                                        │
│           微信扫码支付                  │
│      订单号：RECH20260124220730N6flZ7  │
│              ¥10.00                    │
│                                        │
│         ┌──────────────┐              │
│         │              │              │
│         │   [二维码]    │              │
│         │              │              │
│         └──────────────┘              │
│                                        │
│      请使用微信扫一扫完成支付           │
│         二维码有效期：4:59             │
│                                        │
│      [取消支付]    [我已完成支付]       │
│                                        │
└────────────────────────────────────────┘
```

**元素规范:**
- 标题: `18px`, `#333333` (gray-900), 粗体
- 支付方式: `16px`, `#333333`
- 订单号: `14px`, `#666666` (gray-500)
- 金额: `36px`, `#F44336` (红色), 粗体
- 二维码: `200x200px`
- 提示文字: `14px`, `#666666`
- 倒计时: `14px`, `#F44336` (红色)

**按钮规范:**
| 按钮 | 样式 | 说明 |
|-----|------|------|
| 取消支付 | `btn-secondary` | 白色背景，灰色边框 |
| 我已完成支付 | `btn-primary` | 橙色渐变背景 |

**倒计时逻辑:**
- 格式: `MM:SS`
- 每秒更新
- 归零时自动关闭弹窗，显示过期提示

---

### 3.7 Toast 提示

**成功提示:**
- 图标: 绿色勾选图标 (emerald-500)
- 背景: `#FFFFFF`
- 文字: `#333333`
- 边框: `border-l-4 border-l-emerald-500`
- 位置: 右上角
- 自动消失: 3秒

**示例:** "充值订单已创建"

---

## 4. 交互流程

### 4.1 充值主流程

```
用户进入充值页面
    │
    ▼
显示当前余额 + 金额选择器
    │
    ▼
用户选择/输入充值金额
    │
    ├─ 金额无效 → 显示错误提示，禁用支付按钮
    │
    ▼
用户点击「微信支付」按钮
    │
    ▼
按钮显示loading状态
    │
    ▼
调用创建订单API
    │
    ├─ 失败 → 显示错误Toast，恢复按钮状态
    │
    ▼
显示成功Toast「充值订单已创建」
    │
    ▼
显示支付状态提示卡片
    │
    ▼
用户点击「查看支付二维码」
    │
    ▼
打开二维码弹窗
```

### 4.2 二维码支付流程

```
二维码弹窗打开
    │
    ├─ 启动倒计时（从expired_at计算）
    ├─ 启动轮询（每3秒查询订单状态）
    │
    ▼
用户使用微信扫码支付
    │
    ├─ 用户点击「取消支付」→ 关闭弹窗
    │
    ├─ 倒计时归零 → 关闭弹窗，显示过期提示
    │
    ├─ 轮询检测到 paid 状态 → 跳转成功页
    │
    ├─ 轮询检测到 failed/expired → 跳转失败页
    │
    ▼
用户点击「我已完成支付」
    │
    ▼
主动调用同步API查询状态
    │
    ├─ 已支付 → 跳转成功页
    │
    └─ 未支付 → 显示提示「支付尚未完成，请继续等待」
```

### 4.3 充值记录交互

```
用户查看充值记录列表
    │
    ├─ 点击「刷新」→ 重新加载列表
    │
    ├─ 点击订单号 → 展开订单详情
    │
    ├─ 点击「查看详情」→ 展开订单详情
    │
    ├─ 点击「重新支付」(待支付订单)
    │       │
    │       ▼
    │   打开二维码弹窗（复用同一订单）
    │
    └─ 切换分页 → 加载对应页数据
```

---

## 5. 视觉规范

### 5.1 色彩系统

**主色调 (Claude Orange):**
| 名称 | 色值 | Tailwind | 用途 |
|-----|------|----------|------|
| Primary 50 | `#fef7f4` | `primary-50` | 极浅背景 |
| Primary 100 | `#fde8df` | `primary-100` | 浅色背景、提示卡片 |
| Primary 200 | `#fbd0c0` | `primary-200` | 边框 |
| Primary 300 | `#f7a989` | `primary-300` | 浅色强调 |
| Primary 400 | `#f18a5e` | `primary-400` | 次要强调 |
| Primary 500 | `#d97757` | `primary-500` | **主色**、链接、图标 |
| Primary 600 | `#c45a3a` | `primary-600` | 按钮悬停、深色文字 |
| Primary 700 | `#a34830` | `primary-700` | 按钮按下 |
| Primary 800 | `#863c2a` | `primary-800` | 深色背景 |
| Primary 900 | `#6f3526` | `primary-900` | 最深背景 |

**功能色:**
| 名称 | 色值 | Tailwind | 用途 |
|-----|------|----------|------|
| Success | `#10b981` | `emerald-500` | 成功状态 |
| Warning | `#f59e0b` | `amber-500` | 待支付状态 |
| Error | `#ef4444` | `red-500` | 失败状态、金额显示 |
| Info | `#3b82f6` | `blue-500` | 信息提示、退款状态 |

**中性色 (Accent/Dark):**
| 名称 | 色值 | Tailwind | 用途 |
|-----|------|----------|------|
| Text Primary | `#1e293b` | `gray-900` / `dark-800` | 主要文字 |
| Text Secondary | `#64748b` | `gray-500` / `dark-500` | 次要文字 |
| Text Disabled | `#94a3b8` | `gray-400` / `dark-400` | 禁用文字 |
| Border | `#e2e8f0` | `gray-200` / `dark-600` | 边框 |
| Background | `#f8fafc` | `gray-50` / `dark-950` | 页面背景 |

### 5.2 字体规范

| 类型 | 字号 | 字重 | Tailwind | 用途 |
|-----|------|-----|----------|------|
| H1 | `24px` | Bold | `text-2xl font-bold` | 页面标题 |
| H2 | `18px` | Bold | `text-lg font-semibold` | 卡片标题 |
| H3 | `16px` | Medium | `text-base font-medium` | 区域标题 |
| Body | `14px` | Regular | `text-sm` | 正文内容 |
| Caption | `12px` | Regular | `text-xs` | 辅助说明 |
| Amount Large | `48px` | Bold | `text-5xl font-bold` | 余额大字显示 |
| Amount Medium | `36px` | Bold | `text-4xl font-bold` | 支付金额显示 |

### 5.3 间距规范

| 名称 | 数值 | Tailwind | 用途 |
|-----|------|----------|------|
| xs | `4px` | `p-1` / `gap-1` | 紧凑元素间距 |
| sm | `8px` | `p-2` / `gap-2` | 元素内部间距 |
| md | `16px` | `p-4` / `gap-4` | 卡片内边距 |
| lg | `24px` | `p-6` / `gap-6` | 区块间距 |
| xl | `40px` | `p-10` / `gap-10` | 大区块间距 |

### 5.4 圆角规范

| 类型 | 数值 | Tailwind | 用途 |
|-----|------|----------|------|
| 小圆角 | `4px` | `rounded` | 输入框、小按钮 |
| 中圆角 | `8px` | `rounded-lg` | 标签 |
| 大圆角 | `12px` | `rounded-xl` | 按钮、输入框 |
| 超大圆角 | `16px` | `rounded-2xl` | 弹窗、大卡片 |
| 胶囊形 | `24px` | `rounded-3xl` | 主按钮 |

---

## 6. 状态设计

### 6.1 页面加载状态

**骨架屏:**
- 余额卡片: 橙色渐变背景 + 内容区域白色/半透明占位
- 充值区域: 卡片轮廓 + 内容占位条 (`skeleton` 类)
- 记录列表: 表头 + 3行占位行

### 6.2 空状态

**充值记录为空:**
```
┌─────────────────────────────────────┐
│                                     │
│        [空记录图标]                  │
│                                     │
│        暂无充值记录                  │
│     快去充值，享受更多服务吧          │
│                                     │
│         [立即充值]                   │
│                                     │
└─────────────────────────────────────┘
```

使用 `empty-state` 系列类。

### 6.3 错误状态

**网络错误:**
- 显示错误提示Toast (`toast-error`)
- 提供重试按钮

**金额验证错误:**
- 输入框边框变红 (`input-error`)
- 输入框下方显示错误文字 (`input-error-text`)
- 示例: "充值金额需在 ¥1 ~ ¥1000 之间"

### 6.4 按钮加载状态

**微信支付按钮加载中:**
- 图标替换为旋转loading (`spinner` 类)
- 文字保持不变
- 按钮不可点击 (`disabled`)

---

## 7. 响应式设计

### 7.1 断点定义

| 断点 | 宽度 | Tailwind | 设备 |
|-----|------|----------|------|
| Mobile | `< 768px` | 默认 | 手机 |
| Tablet | `768px - 1024px` | `md:` | 平板 |
| Desktop | `> 1024px` | `lg:` | 桌面 |

### 7.2 移动端适配

**金额选择器:**
- 快捷按钮换行显示（2x2网格）
- 输入框宽度100%

**二维码弹窗:**
- 宽度: `100%` (带内边距)
- 二维码尺寸: `180x180px`

**充值记录表格:**
- 隐藏「订单号」列，改为卡片式布局
- 每条记录显示为独立卡片

---

## 8. 动效规范

### 8.1 过渡动画

| 元素 | 动画 | 时长 | Tailwind/CSS |
|-----|------|-----|--------------|
| 按钮悬停 | 背景色变化 | `200ms` | `transition-all duration-200` |
| 弹窗打开 | 淡入 + 缩放 | `250ms` | `animate-scale-in` |
| 弹窗关闭 | 淡出 + 缩放 | `200ms` | `modal-leave-active` |
| Toast出现 | 从右滑入 | `300ms` | `animate-slide-in-right` |
| Toast消失 | 向右滑出 | `200ms` | - |

### 8.2 加载动画

**按钮Loading:**
- 使用 `spinner` 类
- 旋转动画 `animate-spin`

**二维码加载:**
- 骨架占位 (`skeleton`) → 淡入显示 (`animate-fade-in`)

---

## 9. 可访问性

### 9.1 键盘导航

- Tab键可依次聚焦: 金额输入框 → 快捷按钮 → 支付按钮
- Enter键触发聚焦元素的点击事件
- Escape键关闭弹窗

### 9.2 ARIA标签

```html
<button aria-label="选择充值金额10元">¥10</button>
<button aria-label="微信支付">微信支付</button>
<dialog aria-labelledby="modal-title">...</dialog>
```

---

## 10. 设计资源

### 10.1 图标清单

| 图标名称 | 用途 | 规格 |
|---------|------|------|
| wallet | 余额卡片 | 32x32px |
| wechat-pay | 微信支付按钮 | 24x24px |
| refresh | 刷新按钮 | 20x20px |
| close | 弹窗关闭 | 24x24px |
| success-circle | 成功Toast | 20x20px |
| qrcode | 查看二维码按钮 | 16x16px |

### 10.2 设计文件引用

设计稿基于以下截图创建:
1. 充值主页面 - 包含余额展示、金额选择、支付按钮、订单提示
2. 充值记录列表 - 表格展示、状态标签、分页组件
3. 支付二维码弹窗 - 模态框、二维码、倒计时、操作按钮
4. 支付状态提示卡片 - 订单创建成功提示

---

## 11. 与用户故事的对应关系

| UX组件/页面 | 对应用户故事 |
|------------|-------------|
| 余额展示卡片 | Story 2.1 |
| 金额选择器 | Story 2.2, 2.3 |
| 支付方式按钮 | Story 2.4 |
| 支付状态提示卡片 | Story 2.4 |
| 二维码弹窗 | Story 2.7 |
| 倒计时组件 | Story 4.7 |
| 充值记录表格 | Story 4.2 |
| 成功页面 | Story 4.8 |
| 失败页面 | Story 4.9 |

---

## 更新日志

| 日期 | 版本 | 说明 |
|-----|------|------|
| 2026-01-24 | v1.0 | 基于实际UI截图创建初版UX设计文档 |
| 2026-01-24 | v1.1 | 配色调整为系统统一的 Claude Orange 橙色系，对齐 Tailwind 配置 |
